<section class="review-section">
  <div class="section-header">
    <h2 class="section-title">Reviews</h2>
    
    <ng-container *ngIf="isAuthenticated">
      <ng-container *ngIf="canReview && !showReviewForm">
        <button mat-flat-button color="primary" (click)="onCreateReview()">
          <mat-icon>rate_review</mat-icon>
          Write a Review
        </button>
      </ng-container>
      
      <ng-container *ngIf="existingReview && !showReviewForm">
        <button mat-flat-button color="primary" (click)="onEditReview(existingReview)">
          <mat-icon>edit</mat-icon>
          Edit Your Review
        </button>
      </ng-container>
    </ng-container>
    
    <ng-container *ngIf="!isAuthenticated">
      <a mat-flat-button color="primary" routerLink="/auth/login" [queryParams]="{returnUrl: '/details/' + targetType + '/' + targetId}">
        <mat-icon>login</mat-icon>
        Login to Write a Review
      </a>
    </ng-container>
  </div>
  
  <!-- Review Form -->
  <div class="review-form-container" *ngIf="showReviewForm">
    <app-review-form 
      [targetId]="targetId"
      [targetType]="targetType"
      [existingReview]="existingReview"
      (submitted)="onSubmitReview($event)"
      (cancelled)="onCancelReview()"
    ></app-review-form>
  </div>
  
  <!-- Review List -->
  <app-review-list 
    [targetId]="targetId"
    [targetType]="targetType"
    (reviewEdit)="onEditReview($event)"
    (reviewDeleted)="onReviewDeleted($event)"
  ></app-review-list>
</section>